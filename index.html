<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–Ω–∫–µ—Ç–∞ –∑–∞—ë–º—â–∏–∫–∞</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .form-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .form-header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .form-header h1 {
            font-size: 28px;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .form-header p {
            opacity: 0.9;
            font-size: 16px;
        }

        .form-body {
            padding: 30px;
        }

        .form-section {
            margin-bottom: 30px;
            padding: 25px;
            border: 1px solid #e1e8ed;
            border-radius: 10px;
            background: #fafbfc;
        }

        .section-title {
            font-size: 18px;
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #3498db;
            display: flex;
            align-items: center;
        }

        .section-title::before {
            content: "‚ñ∏";
            margin-right: 10px;
            color: #3498db;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 15px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
            font-size: 14px;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: white;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .checkbox-group input {
            width: auto;
        }

        .dynamic-section {
            background: white;
            border: 2px dashed #bdc3c7;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
        }

        .dynamic-item {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            position: relative;
        }

        .remove-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.3s ease;
        }

        .remove-btn:hover {
            background: #c0392b;
        }

        .add-btn {
            background: #27ae60;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: background 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .add-btn::before {
            content: "+";
            font-size: 18px;
        }

        .add-btn:hover {
            background: #219a52;
        }

        .submit-btn {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: transform 0.3s ease;
            display: block;
            margin: 30px auto 0;
            min-width: 200px;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(52, 152, 219, 0.3);
        }

        .required::after {
            content: " *";
            color: #e74c3c;
        }

        .calculated-totals {
            background: #e8f4fd;
            border: 1px solid #3498db;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
        }

        .total-item {
            margin: 5px 15px;
            font-weight: 600;
            color: #2c3e50;
        }

        .total-value {
            color: #3498db;
            font-weight: 700;
        }

        .download-btn {
            background: linear-gradient(135deg, #27ae60 0%, #219a52 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: transform 0.3s ease;
            display: block;
            margin: 20px auto 0;
            min-width: 250px;
            text-align: center;
            text-decoration: none;
        }

        .download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(39, 174, 96, 0.3);
        }

        .download-btn.hidden {
            display: none;
        }

        .success-message {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            text-align: center;
            color: #155724;
            display: none;
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .form-body {
                padding: 20px;
            }
            
            .form-section {
                padding: 15px;
            }
            
            .calculated-totals {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="form-container">
        <div class="form-header">
            <h1>üìä –ê–Ω–∫–µ—Ç–∞ –∑–∞—ë–º—â–∏–∫–∞</h1>
            <p>–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –¥–ª—è —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏—è –∑–∞—è–≤–∫–∏</p>
        </div>

        <form id="loanForm" class="form-body">
            <!-- –õ–∏—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
            <div class="form-section">
                <h3 class="section-title">üë§ –õ–∏—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label class="required">–§–∞–º–∏–ª–∏—è</label>
                        <input type="text" name="last_name" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ñ–∞–º–∏–ª–∏—é" required>
                    </div>
                    <div class="form-group">
                        <label class="required">–ò–º—è</label>
                        <input type="text" name="first_name" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è" required>
                    </div>
                    <div class="form-group">
                        <label>–û—Ç—á–µ—Å—Ç–≤–æ</label>
                        <input type="text" name="middle_name" placeholder="–í–≤–µ–¥–∏—Ç–µ –æ—Ç—á–µ—Å—Ç–≤–æ">
                    </div>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label>–°–µ–º–µ–π–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ</label>
                        <div class="checkbox-group">
                            <input type="checkbox" name="marital_status" id="marital_status">
                            <label for="marital_status" style="margin-bottom: 0;">–°–æ—Å—Ç–æ—é –≤ –±—Ä–∞–∫–µ</label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="required">–ü–æ–ª</label>
                        <select name="gender" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª</option>
                            <option value="male">–ú—É–∂—Å–∫–æ–π</option>
                            <option value="female">–ñ–µ–Ω—Å–∫–∏–π</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- –ú–µ—Å—è—á–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã -->
            <div class="form-section">
                <h3 class="section-title">üìÖ –ú–µ—Å—è—á–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>–ê—Ä–µ–Ω–¥–∞ –∫–≤–∞—Ä—Ç–∏—Ä—ã</label>
                        <input type="number" name="house_expenses" placeholder="0">
                    </div>
                    <div class="form-group">
                        <label>–ó–∞—Ç—Ä–∞—Ç—ã –Ω–∞ –µ–¥—É</label>
                        <input type="number" name="food_expenses" placeholder="0">
                    </div>
                    <div class="form-group">
                        <label>–ó–∞—Ç—Ä–∞—Ç—ã –Ω–∞ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç</label>
                        <input type="number" name="transport_expenses" placeholder="0">
                    </div>
                </div>
            </div>

            <!-- –ò–º—É—â–µ—Å—Ç–≤–æ -->
            <div class="form-section">
                <h3 class="section-title">üè† –ò–º—É—â–µ—Å—Ç–≤–æ –∑–∞—ë–º—â–∏–∫–∞</h3>
                <div id="ownershipItems">
                    <div class="dynamic-item">
                        <button type="button" class="remove-btn">√ó</button>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –∏–º—É—â–µ—Å—Ç–≤–∞</label>
                                <input type="text" name="ownership[0][name]" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ö–≤–∞—Ä—Ç–∏—Ä–∞">
                            </div>
                            <div class="form-group">
                                <label>–°—Ç–æ–∏–º–æ—Å—Ç—å</label>
                                <input type="number" name="ownership[0][cost]" placeholder="0">
                            </div>
                            <div class="form-group">
                                <label class="checkbox-group">
                                    <input type="checkbox" name="ownership[0][is_jointly]">
                                    –°–æ–≤–º–µ—Å—Ç–Ω–æ –Ω–∞–∂–∏—Ç–æ–µ
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                <button type="button" class="add-btn" onclick="addOwnershipItem()">–î–æ–±–∞–≤–∏—Ç—å –∏–º—É—â–µ—Å—Ç–≤–æ</button>
            </div>

            <!-- –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–æ—Ö–æ–¥–∞ -->
            <div class="form-section">
                <h3 class="section-title">üíº –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–æ—Ö–æ–¥–∞</h3>
                <div id="incomeItems">
                    <div class="dynamic-item">
                        <button type="button" class="remove-btn">√ó</button>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–æ—Ö–æ–¥–∞</label>
                                <input type="text" name="income[0][name]" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –û—Å–Ω–æ–≤–Ω–∞—è —Ä–∞–±–æ—Ç–∞">
                            </div>
                            <div class="form-group">
                                <label>–°—É–º–º–∞ –≤ –º–µ—Å—è—Ü</label>
                                <input type="number" name="income[0][salary]" placeholder="0">
                            </div>
                        </div>
                    </div>
                </div>
                <button type="button" class="add-btn" onclick="addIncomeItem()">–î–æ–±–∞–≤–∏—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–æ—Ö–æ–¥–∞</button>
            </div>

            <!-- –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞ -->
            <div class="form-section">
                <h3 class="section-title">üìã –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞</h3>
                <div id="liabilityItems">
                    <div class="dynamic-item">
                        <button type="button" class="remove-btn">√ó</button>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>–í–∏–¥ –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞</label>
                                <input type="text" name="liabilities[0][name]" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ö—Ä–µ–¥–∏—Ç">
                            </div>
                            <div class="form-group">
                                <label>–ï–∂–µ–º–µ—Å—è—á–Ω—ã–π –ø–ª–∞—Ç–µ–∂</label>
                                <input type="number" name="liabilities[0][monthly_payment]" placeholder="0" class="monthly-payment-input">
                            </div>
                            <div class="form-group">
                                <label>–û–±—â–∞—è —Å—É–º–º–∞</label>
                                <input type="number" name="liabilities[0][total_liability]" placeholder="0" class="total-liability-input">
                            </div>
                        </div>
                    </div>
                </div>
                <button type="button" class="add-btn" onclick="addLiabilityItem()">–î–æ–±–∞–≤–∏—Ç—å –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ</button>
                
                <!-- –ë–ª–æ–∫ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã–º–∏ —Å—É–º–º–∞–º–∏ -->
                <div class="calculated-totals">
                    <div class="total-item">
                        –û–±—â–∞—è —Å—É–º–º–∞ –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤: <span id="totalLiabilities" class="total-value">0</span> —Ä—É–±.
                    </div>
                    <div class="total-item">
                        –û–±—â–∏–π –µ–∂–µ–º–µ—Å—è—á–Ω—ã–π –ø–ª–∞—Ç–µ–∂: <span id="totalMonthlyPayment" class="total-value">0</span> —Ä—É–±.
                    </div>
                </div>
            </div>

            <button type="submit" class="submit-btn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É</button>
            
            <!-- –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–µ -->
            <div id="successMessage" class="success-message">
                <h3>‚úÖ –ó–∞—è–≤–∫–∞ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!</h3>
                <p>–í–∞—à–∞ –∞–Ω–∫–µ—Ç–∞ –±—ã–ª–∞ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–∞. –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ —Å–∫–∞—á–∞—Ç—å PDF-–≤–µ—Ä—Å–∏—é –≤–∞—à–µ–π –∞–Ω–∫–µ—Ç—ã.</p>
            </div>
            
            <!-- –ö–Ω–æ–ø–∫–∞ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è PDF -->
            <a id="downloadPdf" class="download-btn hidden" download="–∞–Ω–∫–µ—Ç–∞_–∑–∞–µ–º—â–∏–∫–∞.pdf">
                üìÑ –°–∫–∞—á–∞—Ç—å –∞–Ω–∫–µ—Ç—É –≤ PDF
            </a>
        </form>
    </div>

    <script>
        let ownershipCount = 0;
        let incomeCount = 0;
        let liabilityCount = 0;

        function addOwnershipItem() {
            ownershipCount++;
            const item = document.createElement('div');
            item.className = 'dynamic-item';
            item.innerHTML = `
                <button type="button" class="remove-btn" onclick="this.parentElement.remove()">√ó</button>
                <div class="form-grid">
                    <div class="form-group">
                        <label>–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –∏–º—É—â–µ—Å—Ç–≤–∞</label>
                        <input type="text" name="ownership[${ownershipCount}][name]" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ê–≤—Ç–æ–º–æ–±–∏–ª—å">
                    </div>
                    <div class="form-group">
                        <label>–°—Ç–æ–∏–º–æ—Å—Ç—å</label>
                        <input type="number" name="ownership[${ownershipCount}][cost]" placeholder="0">
                    </div>
                    <div class="form-group">
                        <label class="checkbox-group">
                            <input type="checkbox" name="ownership[${ownershipCount}][is_jointly]">
                            –°–æ–≤–º–µ—Å—Ç–Ω–æ –Ω–∞–∂–∏—Ç–æ–µ
                        </label>
                    </div>
                </div>
            `;
            document.getElementById('ownershipItems').appendChild(item);
        }

        function addIncomeItem() {
            incomeCount++;
            const item = document.createElement('div');
            item.className = 'dynamic-item';
            item.innerHTML = `
                <button type="button" class="remove-btn" onclick="this.parentElement.remove()">√ó</button>
                <div class="form-grid">
                    <div class="form-group">
                        <label>–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–æ—Ö–æ–¥–∞</label>
                        <input type="text" name="income[${incomeCount}][name]" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ü–æ–¥—Ä–∞–±–æ—Ç–∫–∞">
                    </div>
                    <div class="form-group">
                        <label>–°—É–º–º–∞ –≤ –º–µ—Å—è—Ü</label>
                        <input type="number" name="income[${incomeCount}][salary]" placeholder="0">
                    </div>
                </div>
            `;
            document.getElementById('incomeItems').appendChild(item);
        }

        function addLiabilityItem() {
            liabilityCount++;
            const item = document.createElement('div');
            item.className = 'dynamic-item';
            item.innerHTML = `
                <button type="button" class="remove-btn" onclick="this.parentElement.remove()">√ó</button>
                <div class="form-grid">
                    <div class="form-group">
                        <label>–í–∏–¥ –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞</label>
                        <input type="text" name="liabilities[${liabilityCount}][name]" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ò–ø–æ—Ç–µ–∫–∞">
                    </div>
                    <div class="form-group">
                        <label>–ï–∂–µ–º–µ—Å—è—á–Ω—ã–π –ø–ª–∞—Ç–µ–∂</label>
                        <input type="number" name="liabilities[${liabilityCount}][monthly_payment]" placeholder="0" class="monthly-payment-input">
                    </div>
                    <div class="form-group">
                        <label>–û–±—â–∞—è —Å—É–º–º–∞</label>
                        <input type="number" name="liabilities[${liabilityCount}][total_liability]" placeholder="0" class="total-liability-input">
                    </div>
                </div>
            `;
            document.getElementById('liabilityItems').appendChild(item);
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª–µ–π
            const monthlyPaymentInput = item.querySelector('.monthly-payment-input');
            const totalLiabilityInput = item.querySelector('.total-liability-input');
            
            monthlyPaymentInput.addEventListener('input', calculateTotals);
            totalLiabilityInput.addEventListener('input', calculateTotals);
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –æ–±—â–∏—Ö —Å—É–º–º
        function calculateTotals() {
            let totalLiabilities = 0;
            let totalMonthlyPayment = 0;
            
            // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ –ø–æ–ª—è —Å –µ–∂–µ–º–µ—Å—è—á–Ω—ã–º–∏ –ø–ª–∞—Ç–µ–∂–∞–º–∏ –∏ –æ–±—â–∏–º–∏ —Å—É–º–º–∞–º–∏
            const monthlyPaymentInputs = document.querySelectorAll('.monthly-payment-input');
            const totalLiabilityInputs = document.querySelectorAll('.total-liability-input');
            
            // –°—É–º–º–∏—Ä—É–µ–º –µ–∂–µ–º–µ—Å—è—á–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏
            monthlyPaymentInputs.forEach(input => {
                const value = parseFloat(input.value) || 0;
                totalMonthlyPayment += value;
            });
            
            // –°—É–º–º–∏—Ä—É–µ–º –æ–±—â–∏–µ —Å—É–º–º—ã –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤
            totalLiabilityInputs.forEach(input => {
                const value = parseFloat(input.value) || 0;
                totalLiabilities += value;
            });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—É–º–º
            document.getElementById('totalLiabilities').textContent = totalLiabilities.toLocaleString('ru-RU');
            document.getElementById('totalMonthlyPayment').textContent = totalMonthlyPayment.toLocaleString('ru-RU');
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('remove-btn')) {
                e.target.parentElement.remove();
                // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—É–º–º—ã –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–∞
                setTimeout(calculateTotals, 0);
            }
        });

        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª–µ–π –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            const monthlyPaymentInputs = document.querySelectorAll('.monthly-payment-input');
            const totalLiabilityInputs = document.querySelectorAll('.total-liability-input');
            
            monthlyPaymentInputs.forEach(input => {
                input.addEventListener('input', calculateTotals);
            });
            
            totalLiabilityInputs.forEach(input => {
                input.addEventListener('input', calculateTotals);
            });
            
            // –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç
            calculateTotals();
        });

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è PDF –∏–∑ –±–∞–π—Ç–æ–≤
        function downloadPdfFromBytes(pdfBytes, filename) {
            // –°–æ–∑–¥–∞–µ–º Blob –∏–∑ –±–∞–π—Ç–æ–≤
            const blob = new Blob([pdfBytes], { type: 'application/pdf' });
            
            // –°–æ–∑–¥–∞–µ–º URL –¥–ª—è Blob
            const url = URL.createObjectURL(blob);
            
            // –ü–æ–ª—É—á–∞–µ–º —Å—Å—ã–ª–∫—É –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
            const downloadLink = document.getElementById('downloadPdf');
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º URL –∏ –∏–º—è —Ñ–∞–π–ª–∞
            downloadLink.href = url;
            downloadLink.download = filename;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Å—ã–ª–∫—É –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
            downloadLink.classList.remove('hidden');
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–Ω–∏—Ü–∏–∏—Ä—É–µ–º —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ
            downloadLink.click();
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
        document.getElementById('loanForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitBtn = this.querySelector('.submit-btn');
            submitBtn.textContent = '–û—Ç–ø—Ä–∞–≤–∫–∞...';
            submitBtn.disabled = true;

            const formData = new FormData(this);
            const data = serializeFormData(formData);
            
            try {
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
                const response = await fetch('https://y2sujg-95-26-207-148.ru.tuna.am/test', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                
                if (response.ok) {
                    // –ü–æ–ª—É—á–∞–µ–º –±–∞–π—Ç—ã PDF —Ñ–∞–π–ª–∞ –∏–∑ –æ—Ç–≤–µ—Ç–∞
                    const pdfBytes = await response.arrayBuffer();
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ
                    document.getElementById('successMessage').style.display = 'block';
                    
                    // –°–æ–∑–¥–∞–µ–º –∏ —Å–∫–∞—á–∏–≤–∞–µ–º PDF
                    const filename = `–∞–Ω–∫–µ—Ç–∞_–∑–∞–µ–º—â–∏–∫–∞_${data.personal_info.last_name}_${data.personal_info.first_name}.pdf`;
                    downloadPdfFromBytes(pdfBytes, filename);
                    
                    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É
                    this.reset();
                    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ä–∞—Å—á–µ—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
                    calculateTotals();
                } else {
                    throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞');
                }
            } catch (error) {
                alert('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö');
                console.error('–û—à–∏–±–∫–∞:', error);
            } finally {
                submitBtn.textContent = '–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É';
                submitBtn.disabled = false;
            }
        });

        function serializeFormData(formData) {
            const data = {
                personal_info: {
                    last_name: formData.get('last_name'),
                    first_name: formData.get('first_name'),
                    middle_name: formData.get('middle_name'),
                    marital_status: formData.get('marital_status') === 'on',
                    gender: formData.get('gender')
                },
                monthly_expenses: {
                    house_expenses: parseInt(formData.get('house_expenses')) || 0,
                    food_expenses: parseInt(formData.get('food_expenses')) || 0,
                    transport_expenses: parseInt(formData.get('transport_expenses')) || 0
                },
                ownership: [],
                sources_of_official_income: [],
                liabilities: [],
                totals: {
                    // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤–º–µ—Å—Ç–æ –ø–æ–ª–µ–π —Ñ–æ—Ä–º—ã
                    total_liabilities: parseFloat(document.getElementById('totalLiabilities').textContent.replace(/\s/g, '')) || 0,
                    monthly_payment: parseFloat(document.getElementById('totalMonthlyPayment').textContent.replace(/\s/g, '')) || 0
                }
            };

            // –°–æ–±–∏—Ä–∞–µ–º –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ
            formData.forEach((value, key) => {
                const match = key.match(/(\w+)\[(\d+)\]\[(\w+)\]/);
                if (match) {
                    const [, type, index, field] = match;
                    if (!data[type][index]) {
                        data[type][index] = {};
                    }
                    data[type][index][field] = field === 'is_jointly' ? value === 'on' : 
                                              field === 'salary' || field === 'cost' || 
                                              field === 'monthly_payment' || field === 'total_liability' 
                                              ? parseInt(value) || 0 : value;
                }
            });

            // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ –º–∞—Å—Å–∏–≤—ã –∏ —Ñ–∏–ª—å—Ç—Ä—É–µ–º –ø—É—Å—Ç—ã–µ
            data.ownership = Object.values(data.ownership).filter(item => item.name);
            data.sources_of_official_income = Object.values(data.sources_of_official_income).filter(item => item.name);
            data.liabilities = Object.values(data.liabilities).filter(item => item.name);

            return data;
        }
    </script>
</body>
</html>
